# speleothem-IADV

This github repository provides the code used to produce results and figures from Parker, S.E., Harrison, S.P. and Braconnot, P. Speleothem records of monsoon interannual-decadal variability through the Holocene, *in progress*.

Contact: Sarah Parker, s.parker@pgr.reading.ac.uk

## Structure of repository
### Sites map (Fig. 1)
#### Data required:
* CRU global gridded precipitation (available from https://doi.org/10.5285/58a8802721c94c66ae45c3baa4d814d0)
* ERSSTv5 NINO3.4 sea-surface temperatures (available from https://www.cpc.ncep.noaa.gov/data/indices/sstoi.indices)
* World land shape file (available from https://www.naturalearthdata.com/downloads/110m-physical-vectors/)

#### Code:
* "site_map/CRUpre_NINO34corr.R" loads and processes NINO3.4 and CRU precipitation data, calculates precipitation-NINO3.4 SST correlation coefficient for each grid across globe. Outputs coefficients as csv files.
* "site_map/plot_map.R" plots correlation coefficients as global map (using csv files generated by "site_map/CRUpre_NINO34corr.R") with speleothem sites (using sites_stdev_analysis.csv file generated by "MLR_spel_d18O.R")


### Multiple linear regression (Fig. 2, Table 1) and IADV regional composites (Fig. 3)

#### Data required:
* SISALv2 (as MySQL database, available from http://dx.doi.org/10.17864/1947.256)

#### Code:
* "spel_IADV/MLR_spel_d18O.R" loads and filters d18O data from SISALv2 (requiring functions loaded from "spel_IADV/coverage_samples_vs_gap.R" and "spel_IADV/entity_sampling_mean_res.R"), extracts variables for MLR, generates MLR models (Fig. 2, Table 1). Code uses MLR results to apply correction to d18O s.d values and generates regional monsoon IADV composites (Fig. 3). Composite data is saved as spel_sd.csv. Linear regression of spel IADV ~ time is carried out for Table 2.



### Breakpoint analysis of IADV composites (Fig. 4, Tables 2)

#### Code: 
* "spel_IADV/brkpts_spel.R" loads data from "spel_sd.csv" (generated in "spel_IADV/MLR_spel_d18O.R") and carries out breakpoint analysis of IADV trends.



### Model versus speleothem IADV evolution (Fig. 5)

#### Data required
Simulated precipitation (as NetCDF) files from:
* IPSL Vlr CM5 (reference: [Dufresne et al. 2013](https://doi.org/10.1007/s00382-012-1636-1))
* IPSL Sr CM6 (reference: [Braconnot et al. 2019](https://doi.org/10.5194/cp-15-997-2019))
* AWI (reference: [Sidorenko et al. 2019](https://doi.org/10.1029/2019MS001696))
* MPI (reference: [Dallmeyer et al. 2020](https://doi.org/10.5194/cp-16-117-2020))

#### Code:
* "modelled_IADV/reshape_MPI_AWI.R" loads and reshapes MPI and AWI data so that longitude = -180 -> 180, and variable names match the IPSL. Processed data is saved as RData files.
* "modelled_IADV/model_ppt_sd_mean.R" load IPSL NetCDF files and processed MPI and AWI files (generated by "reshape_MPI_AWI.R"), calculates regional averaged summer precipitation for each model year, then calculates the standard deviation and mean for 100 years windows, generated data outputted as csv files.
* "modelled_IADV/lm_model_reg.R" loads modelled precipitation IADV time series from "region_pre_sd.csv" (generated by "modelled_IADV/model_ppt_sd_mean.R") and carries out a linear regression of IADV ~ time (Table 2).
* "modelled_IADV/ppt_IAV_segments.R" loads modelled precipitation IADV time series from region_pre_sd.csv (generated by "modelled_IADV/model_ppt_sd_mean.R"), separates each regional timeseries into groups using breakpoints from "spel_breakpoints.csv" (generated in "brkpts_spel.R"), calculates pairwise t-tests amongst groups, and the linear regression of IADV vs time for each group. 
* "modelled_IADV/spel_ppt_sd_trends.R" plots speleothem IADV (loaded from spel_sd.csv files generated by "spel_IADV/MLR_spel_d18O.R") and modelled precipitation IADV (loaded from "region_pre_sd.csv" generated by "modelled_IADV/model_ppt_sd_mean.R") together (Fig. 5)


### Long-term evolution versus IADV

#### Data required:
* SISALv2 (as MySQL database, available from http://dx.doi.org/10.17864/1947.256)

#### Code:
* "longterm_v_IADV/comp_d18O_zscore_extract" generates long-term regional evolution composites from SISALv2, saves data as a csv file
* "longterm_v_IADV/long_term_evolution_plots.R" loads long-term evolution data from speleothem data ("d18O_bin_zscore.csv" and "d18O_comp_zscore.csv" from "longterm_v_IADV/comp_d18O_zscore_extract.R") and mean modelled precipitation (from "region_pre_sd.csv" generated in "modelled_IADV/model_ppt_sd_mean.R") and visualise as a multiplot (Fig. 6)
* "longterm_v_IADV/monsoon_mean_vs_var.R" loads long-term evolution ("longterm_v_IADV/d18O_bin_zscore.csv", modelled_IADV/region_pre_sd.csv) and IADV data (spel_IADV/spel_sd.csv, modelled_IADV/region_pre_sd.csv) for speleothems and modelled precipitation, carries out linear regression of IADV ~ long-term evoltuion, and plots relationships (Fig. 7). 
